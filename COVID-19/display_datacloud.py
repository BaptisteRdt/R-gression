## Imports
import array
import numpy as np
from matplotlib import pyplot as plt
from datetime import datetime
from sklearn.metrics import mean_squared_error
from sklearn.preprocessing import PolynomialFeatures
from sklearn.pipeline import make_pipeline
from sklearn.linear_model import Ridge

## Functions 
# This function is used to split my dataset in 3 parts because these parts are very distinc
def split_data(dataset, x, x_test, y1, y1_test, y2, y2_test, begin, end):
  for i in range(begin, end):
    if i%3!=0:
      x = np.append(x, datetime.strptime(dataset[i][0], '%Y-%m-%d'))
      y1 = np.append(y1, dataset[i][1])
      y2 = np.append(y2, dataset[i][2])
    else: 
      x_test = np.append(x_test, datetime.strptime(dataset[i][0], '%Y-%m-%d'))
      y1_test = np.append(y1_test, dataset[i][1])
      y2_test = np.append(y2_test, dataset[i][2])
    
  return x, x_test, y1, y1_test, y2, y2_test

# Turn a datetime into an index  
def datetime_to_index(dataset, d):
  date_0 = datetime.strptime(dataset[0][0], '%Y-%m-%d')
  return abs(d - date_0).days

# Turn an array of datetime types inrto an array of indexes
def array_date_to_array_index(dataset, a, a_ex):
  for i in range(np.shape(a_ex)[0]):
    a = np.append(a, datetime_to_index(dataset, a_ex[i][0]))

  a = a[:, np.newaxis]
  return a

## Set up my dataset (Has to be improved because it's annoying here)
dataset = [['2020-04-01', 5094, 508, 0],
          ['2020-04-03', 3699, 1119, 0],
          ['2020-04-04', 3513, 1052, 0],
          ['2020-04-05', 3445, 517, 0],
          ['2020-04-07', 2897, 1416, 0],
          ['2020-04-08', 3504, 540, 0],
          ['2020-04-09', 3618, 1339, 0],
          ['2020-04-10', 3789, 986, 0],
          ['2020-04-12', 2787, 561, 0],
          ['2020-04-13', 2241, 574, 0],
          ['2020-04-16', 3263, 752, 0],
          ['2020-04-18', 1701, 395, 0],
          ['2020-04-20', 1637, 546, 0],
          ['2020-04-21', 1667, 530, 0],
          ['2020-04-23', 1862, 389, 0],
          ['2020-04-25', 1504, 369, 0],
          ['2020-04-26', 1142, 400, 0],
          ['2020-04-27', 1745, 436, 0],
          ['2020-04-29', 2159, 426, 0],
          ['2020-05-01', 1100, 166, 0],
          ['2020-05-03', 530, 306, 0],
          ['2020-05-05', 618, 300, 0],
          ['2020-05-06', 1821, 278, 0],
          ['2020-05-09', 529, 178, 0],
          ['2020-05-12', 426, 348, 0],
          ['2020-05-14', 571, 351, 0],
          ['2020-05-16', 484, 96, 0],
          ['2020-05-19', 353, 119, 0],
          ['2020-05-22', 350, 83, 0],
          ['2020-05-25', 225, 65, 0],
          ['2020-05-27', 257, 98, 0],
          ['2020-05-30', 1785, 57, 0],
          ['2020-06-01', 752, 31, 0],
          ['2020-06-03', 310, 107, 0],
          ['2020-06-05', 541, 46, 0],
          ['2020-06-07', 479, 54, 0],
          ['2020-06-09', 299, 87, 0],
          ['2020-06-11', 430, 28, 0],
          ['2020-06-13', 525, 24, 0],
          ['2020-06-15', 339, 111, 0],
          ['2020-06-17', 299, 28, 0],
          ['2020-06-20', 600, 0, 0],
          ['2020-06-22', 407, 23, 0],
          ['2020-06-24', 304, 21, 0],
          ['2020-06-26', 522, 26, 0],
          ['2020-06-28', 823, 18, 0],
          ['2020-06-30', 421, 30, 0],
          ['2020-07-02', 662, 18, 0],
          ['2020-07-04', 563, 18, 0],
          ['2020-07-07', 404, 32, 0],
          ['2020-07-09', 550, 0, 0],
          ['2020-07-12', 624, 0, 0],
          ['2020-07-15', 380, 71, 0],
          ['2020-07-17', 559, 18, 0],
          ['2020-07-20', 651, 0, 0],
          ['2020-07-22', 605, 0, 0],
          ['2020-07-24', 998, 0, 0],
          ['2020-07-26', 991, 0, 0],
          ['2020-07-28', 706, 0, 0],
          ['2020-07-31', 1287, 0, 0],
          ['2020-08-02', 1303, 0, 0],
          ['2020-08-04', 1381, 22, 0],
          ['2020-08-06', 1357, 0, 0],
          ['2020-08-08', 1854, 0, 0],
          ['2020-08-11', 1319, 0, 0],
          ['2020-08-14', 2515, 17, 0],
          ['2020-08-17', 2132, 24, 0],
          ['2020-08-20', 3374, 17, 0],
          ['2020-08-21', 4108, 23, 0],
          ['2020-08-23', 4093, 0, 0],
          ['2020-08-25', 3177, 0, 0],
          ['2020-08-27', 4643, 32, 0],
          ['2020-08-28', 5919, 0, 0],
          ['2020-08-29', 5925, 0, 0],
          ['2020-08-30', 5708, 29, 0],
          ['2020-09-01', 4215, 26, 0],
          ['2020-09-02', 4718, 0, 0],
          ['2020-09-03', 5992, 0, 0],
          ['2020-09-05', 7721, 0, 0],
          ['2020-09-06', 7694, 0, 0],
          ['2020-09-07', 6202, 25, 0],
          ['2020-09-09', 6045, 30, 0],
          ['2020-09-10', 7809, 0, 0],
          ['2020-09-11', 8704, 80, 0],
          ['2020-09-12', 9325, 17, 0],
          ['2020-09-15', 6630, 49, 0],
          ['2020-09-16', 7443, 46, 0],
          ['2020-09-18', 10508, 50, 0],
          ['2020-09-19', 11670, 26, 0],
          ['2020-09-20', 11663, 53, 0],
          ['2020-09-22', 8094, 0, 0],
          ['2020-09-23', 8877, 43, 0],
          ['2020-09-24', 12255, 52, 0],
          ['2020-09-25', 14066, 150, 0],
          ['2020-09-27', 12929, 27, 0],
          ['2020-09-28', 9261, 81, 0],
          ['2020-09-29', 7270, 85, 0],
          ['2020-10-01', 10906, 63, 0],
          ['2020-10-02', 12188, 130, 0],
          ['2020-10-03', 13479, 49, 0],
          ['2020-10-04', 10830, 69, 0],
          ['2020-10-06', 8802, 66, 0],
          ['2020-10-07', 10735, 80, 0],
          ['2020-10-09', 17897, 109, 0],
          ['2020-10-10', 20447, 54, 0],
          ['2020-10-11', 19812, 46, 0],
          ['2020-10-12', 16111, 108, 0],
          ['2020-10-14', 13791, 104, 0],
          ['2020-10-15', 20710, 88, 0],
          ['2020-10-16', 24493, 89, 0],
          ['2020-10-18', 27325, 85, 0],
          ['2020-10-19', 23619, 146, 0],
          ['2020-10-20', 19879, 163, 0],
          ['2020-10-22', 27767, 162, 0],
          ['2020-10-23', 34513, 298, 0],
          ['2020-10-24', 40377, 116, 0],
          ['2020-10-25', 43627, 257, 0],
          ['2020-10-27', 35097, 523, 0],
          ['2020-10-28', 30226, 0, 0],
          ['2020-10-29', 36753, 235, 0],
          ['2020-10-31', 41446, 223, 0],
          ['2020-11-01', 41630, 0, 0],
          ['2020-11-02', 43270, 467, 0],
          ['2020-11-04', 42299, 437, 0],
          ['2020-11-05', 44028, 0, 0],
          ['2020-11-06', 51584, 880, 0],
          ['2020-11-07', 66066, 356, 0],
          ['2020-11-09', 47371, 322, 0],
          ['2020-11-10', 27141, 857, 0],
          ['2020-11-11', 26284, 328, 0],
          ['2020-11-13', 30861, 425, 0],
          ['2020-11-14', 29678, 552, 0],
          ['2020-11-17', 17215, 704, 0],
          ['2020-11-18', 16970, 677, 0],
          ['2020-11-19', 20038, 681, 0],
          ['2020-11-20', 22653, 634, 0],
          ['2020-11-22', 16866, 352, 0],
          ['2020-11-24', 8372, 592, 0],
          ['2020-11-26', 12199, 527, 0],
          ['2020-11-27', 13234, 581, 0],
          ['2020-11-28', 12075, 316, 0],
          ['2020-11-30', 8249, 509, 0],
          ['2020-12-01', 6842, 466, 0],
          ['2020-12-04', 11881, 397, 0],
          ['2020-12-06', 11001, 287, 0],
          ['2020-12-09', 9922, 403, 0],
          ['2020-12-11', 13060, 350, 0],
          ['2020-12-13', 12164, 271, 0],
          ['2020-12-14', 8928, 492, 0],
          ['2020-12-17', 14828, 376, 0],
          ['2020-12-19', 16108, 236, 0],
          ['2020-12-22', 9506, 487, 0],
          ['2020-12-24', 15127, 373, 0],
          ['2020-12-27', 10066, 230, 0],
          ['2020-12-30', 12766, 468, 0],
          ['2021-01-01', 6842, 207, 0],
          ['2021-01-04', 6249, 453, 0],
          ['2021-01-06', 15607, 387, 0],
          ['2021-01-08', 20926, 381, 0],
          ['2021-01-10', 17497, 248, 0],
          ['2021-01-13', 14761, 347, 0],
          ['2021-01-15', 20756, 264, 0],
          ['2021-01-18', 13071, 475, 0],
          ['2021-01-21', 22911, 456, 0],
          ['2021-01-23', 21917, 237, 0],
          ['2021-01-26', 14002, 417, 0],
          ['2021-01-29', 23006, 510, 0],
          ['2021-01-31', 20797, 322, 0],
          ['2021-02-01', 15007, 536, 0],
          ['2021-02-03', 16906, 476, 0],
          ['2021-02-05', 22506, 413, 0],
          ['2021-02-07', 19532, 243, 0],
          ['2021-02-09', 13420, 508, 0],
          ['2021-02-12', 21006, 468, 0],
          ['2021-02-14', 18292, 226, 0],
          ['2021-02-16', 12673, 391, 0],
          ['2021-02-18', 20993, 352, 0],
          ['2021-02-21', 21438, 163, 0],
          ['2021-02-24', 17589, 363, 0],
          ['2021-02-26', 25691, 379, 0],
          ['2021-03-01', 15219, 404, 0],
          ['2021-03-03', 17001, 389, 0],
          ['2021-03-06', 22551, 187, 0],
          ['2021-03-09', 15783, 316, 0],
          ['2021-03-11', 25267, 296, 0],
          ['2021-03-14', 25441, 137, 0],
          ['2021-03-16', 19641, 357, 0],
          ['2021-03-18', 32368, 327, 0],
          ['2021-03-20', 32975, 170, 0],
          ['2021-03-22', 32376, 402, 0],
          ['2021-03-24', 29981, 285, 0],
          ['2021-03-27', 40706, 201, 0],
          ['2021-03-29', 33858, 371, 0],
          ['2021-04-01', 37816, 304, 0],
          ['2021-04-04', 39849, 185, 0],
          ['2021-04-06', 40997, 414, 0],
          ['2021-04-08', 32674, 374, 0],
          ['2021-04-10', 37357, 179, 0],
          ['2021-04-13', 25821, 385, 0],
          ['2021-04-15', 37745, 302, 0],
          ['2021-04-18', 31797, 140, 0],
          ['2021-04-21', 26514, 313, 0],
          ['2021-04-23', 31789, 332, 0],
          ['2021-04-26', 19723, 405, 0],
          ['2021-04-28', 21211, 333, 0],
          ['2021-04-30', 25769, 276, 0],
          ['2021-05-01', 23932, 195, 0],
          ['2021-05-04', 11893, 247, 0],
          ['2021-05-06', 22548, 252, 0],
          ['2021-05-09', 15327, 119, 0],
          ['2021-05-11', 10076, 240, 0],
          ['2021-05-13', 19004, 131, 0],
          ['2021-05-17', 10317, 206, 0],
          ['2021-05-19', 12390, 146, 0],
          ['2021-05-21', 15364, 113, 0],
          ['2021-05-23', 11708, 76, 0],
          ['2021-05-26', 6010, 151, 0],
          ['2021-05-28', 12616, 107, 0],
          ['2021-05-31', 6809, 128, 1],
          ['2021-06-01', 6533, 129, 1],
          ['2021-06-04', 7952, 84, 1],
          ['2021-06-07', 4297, 73, 1],
          ['2021-06-10', 5349, 70, 1],
          ['2021-06-12', 4106, 71, 1],
          ['2021-06-14', 2505, 63, 1],
          ['2021-06-17', 2779, 62, 1],
          ['2021-06-20', 2540, 40, 1],
          ['2021-06-23', 1671, 44, 1],
          ['2021-06-26', 2040, 33, 1],
          ['2021-06-29', 1467, 33, 1],
          ['2021-07-01', 2478, 29, 1],
          ['2021-07-03', 2785, 17, 1],
          ['2021-07-06', 2310, 34, 1],
          ['2021-07-09', 4368, 19, 1],
          ['2021-07-12', 3404, 28, 1],
          ['2021-07-15', 6480, 22, 2],
          ['2021-07-18', 11463, 20, 2],
          ['2021-07-20', 11622, 33, 2],
          ['2021-07-23', 21003, 25, 2],
          ['2021-07-25', 20142, 31, 2],
          ['2021-07-28', 20037, 44, 2],
          ['2021-07-31', 24324, 47, 2],
          ['2021-08-01', 22460, 56, 2],
          ['2021-08-03', 17204, 59, 2],
          ['2021-08-05', 27357, 57, 2],
          ['2021-08-08', 23761, 33, 2],
          ['2021-08-11', 21757, 60, 2],
          ['2021-08-14', 26478, 49, 2],
          ['2021-08-16', 17143, 107, 2],
          ['2021-08-19', 26831, 140, 2],
          ['2021-08-20', 24899, 89, 2],
          ['2021-08-22', 20751, 49, 2],
          ['2021-08-24', 15773, 169, 2],
          ['2021-08-27', 20546, 109, 2],
          ['2021-08-28', 18507, 61, 2],
          ['2021-08-30', 11672, 112, 2],
          ['2021-08-31', 12283, 0, 2],
          ['2021-09-01', 17652, 86, 2],
          ['2021-09-04', 14238, 83, 2],
          ['2021-09-07', 9329, 152, 2],
          ['2021-09-10', 11255, 80, 2],
          ['2021-09-13', 6448, 147, 2],
          ['2021-09-15', 7178, 79, 2],
          ['2021-09-18', 7639, 42, 2],
          ['2021-09-21', 5060, 153, 2],
          ['2021-09-24', 6300, 49, 2],
          ['2021-09-26', 5533, 29, 2],
          ['2021-09-29', 4636, 42, 2],
          ['2021-09-30', 5935, 0, 2],
          ['2021-10-01', 5029, 46, 2],
          ['2021-10-03', 4543, 50, 2],
          ['2021-10-05', 3480, 34, 2],
          ['2021-10-07', 5040, 34, 2],
          ['2021-10-08', 4677, 38, 2],
          ['2021-10-10', 4398, 0, 2],
          ['2021-10-11', 3282, 68, 2],
          ['2021-10-13', 4192, 23, 2],
          ['2021-10-14', 5549, 34, 2],
          ['2021-10-16', 5395, 0, 2],
          ['2021-10-18', 3245, 41, 2],
          ['2021-10-19', 3590, 49, 2],
          ['2021-10-21', 6032, 35, 2],
          ['2021-10-22', 6177, 29, 2],
          ['2021-10-24', 5887, 0, 2],
          ['2021-10-26', 4301, 47, 2],
          ['2021-10-27', 4809, 33, 2],
          ['2021-10-29', 6474, 27, 2],
          ['2021-10-30', 6751, 22, 2],
          ['2021-11-01', 5185, 0, 2],
          ['2021-11-02', 3412, 39, 2],
          ['2021-11-04', 7197, 47, 2],
          ['2021-11-06', 9368, 25, 2],
          ['2021-11-07', 9050, 55, 2],
          ['2021-11-09', 7740, 58, 2],
          ['2021-11-10', 8852, 17, 2],
          ['2021-11-12', 9449, 48, 2],
          ['2021-11-13', 10369, 17, 2],
          ['2021-11-15', 10128, 47, 2],
          ['2021-11-17', 14438, 50, 2],
          ['2021-11-18', 20146, 50, 2],
          ['2021-11-20', 21421, 23, 2],
          ['2021-11-21', 21216, 94, 2],
          ['2021-11-23', 18490, 98, 2],
          ['2021-11-26', 33497, 43, 2],
          ['2021-11-28', 34434, 23, 2],
          ['2021-11-29', 25715, 115, 2],
          ['2021-12-01', 35022, 96, 3],
          ['2021-12-02', 48401, 127, 3],
          ['2021-12-04', 49966, 49, 3],
          ['2021-12-05', 47911, 192, 3],
          ['2021-12-07', 37527, 133, 3],
          ['2021-12-09', 59071, 136, 3],
          ['2021-12-10', 57844, 65, 3],
          ['2021-12-12', 50969, 48, 3],
          ['2021-12-13', 36535, 158, 3],
          ['2021-12-15', 47051, 151, 3],
          ['2021-12-16', 63328, 162, 3],
          ['2021-12-18', 59177, 75, 3],
          ['2021-12-20', 40694, 224, 3],
          ['2021-12-21', 45460, 170, 3],
          ['2021-12-23', 82904, 179, 3],
          ['2021-12-24', 90002, 84, 3],
          ['2021-12-26', 75477, 96, 3],
          ['2021-12-28', 79296, 290, 3],
          ['2021-12-29', 139430, 180, 3],
          ['2021-12-31', 215514, 189, 3],
          ['2022-01-01', 219190, 91, 3],
          ['2022-01-03', 115007, 270, 3],
          ['2022-01-04', 132526, 246, 3],
          ['2022-01-06', 288473, 204, 3],
          ['2022-01-08', 297788, 142, 3],
          ['2022-01-09', 309327, 280, 3],
          ['2022-01-11', 252714, 341, 3],
          ['2022-01-12', 274588, 225, 3],
          ['2022-01-14', 332137, 191, 3],
          ['2022-01-15', 319758, 98, 3],
          ['2022-01-17', 234951, 375, 3],
          ['2022-01-19', 334360, 231, 3],
          ['2022-01-20', 442040, 233, 3],
          ['2022-01-22', 405118, 167, 3],
          ['2022-01-23', 363929, 393, 3],
          ['2022-01-25', 303910, 467, 3],
          ['2022-01-26', 346042, 268, 3],
          ['2022-01-28', 391227, 178, 3],
          ['2022-01-30', 311783, 127, 3],
          ['2022-01-31', 221501, 381, 3],
          ['2022-02-02', 271639, 276, 3],
          ['2022-02-03', 335537, 355, 3],
          ['2022-02-05', 243314, 170, 3],
          ['2022-02-06', 203677, 417, 3],
          ['2022-02-08', 145569, 283, 3],
          ['2022-02-10', 189302, 310, 3],
          ['2022-02-11', 154672, 161, 3],
          ['2022-02-13', 112183, 107, 3],
          ['2022-02-14', 77216, 390, 3],
          ['2022-02-16', 89154, 276, 3],
          ['2022-02-17', 111111, 304, 3],
          ['2022-02-19', 83845, 114, 3],
          ['2022-02-21', 50945, 283, 3],
          ['2022-02-22', 57860, 213, 3],
          ['2022-02-24', 76982, 281, 3],
          ['2022-02-25', 63901, 101, 3],
          ['2022-02-27', 51454, 76, 3],
          ['2022-03-01', 45293, 209, 3],
          ['2022-03-02', 50324, 180, 3],
          ['2022-03-04', 58570, 181, 3],
          ['2022-03-05', 57231, 120, 3],
          ['2022-03-07', 37834, 176, 3],
          ['2022-03-08', 50958, 155, 3],
          ['2022-03-10', 79019, 107, 3],
          ['2022-03-12', 73220, 51, 3],
          ['2022-03-13', 68421, 185, 3],
          ['2022-03-15', 65297, 146, 3],
          ['2022-03-16', 81435, 116, 3],
          ['2022-03-18', 102720, 112, 3],
          ['2022-03-19', 99143, 30, 3],
          ['2022-03-21', 67855, 133, 3],
          ['2022-03-23', 116839, 101, 3],
          ['2022-03-24', 158324, 121, 3],
          ['2022-03-26', 143908, 67, 3],
          ['2022-03-27', 131087, 149, 3],
          ['2022-03-29', 119036, 164, 3],
          ['2022-03-30', 138653, 139, 3],
          ['2022-04-01', 162321, 68, 3],
          ['2022-04-03', 127670, 31, 3],
          ['2022-04-04', 87342, 129, 3],
          ['2022-04-06', 130873, 128, 3],
          ['2022-04-07', 174587, 139, 3],
          ['2022-04-09', 149750, 87, 3],
          ['2022-04-10', 132704, 178, 3],
          ['2022-04-12', 107969, 152, 3],
          ['2022-04-14', 158177, 133, 3],
          ['2022-04-15', 136387, 61, 3],
          ['2022-04-17', 107876, 35, 3],
          ['2022-04-18', 72681, 182, 3],
          ['2022-04-20', 66995, 227, 3],
          ['2022-04-21', 95061, 185, 3],
]

## Split the dataset in tree parts
first_x = np.array([])
first_x_test = np.array([])
first_y1 = np.array([])
first_y1_test = np.array([])  
first_y2 = np.array([])
first_y2_test = np.array([])
second_x = np.array([]) 
second_x_test = np.array([]) 
second_y1 = np.array([]) 
second_y1_test = np.array([]) 
second_y2 = np.array([]) 
second_y2_test = np.array([]) 
third_x = np.array([]) 
third_x_test = np.array([]) 
third_y1 = np.array([]) 
third_y1_test = np.array([]) 
third_y2 = np.array([])
third_y2_test = np.array([])


first_x, first_x_test, first_y1, first_y1_test, first_y2, first_y2_test = split_data(dataset, first_x, first_x_test, first_y1, first_y1_test, first_y2, first_y2_test, 0, 150)
second_x, second_x_test, second_y1, second_y1_test, second_y2, second_y2_test = split_data(dataset, second_x, second_x_test, second_y1, second_y1_test, second_y2, second_y2_test, 150, 280)
third_x, third_x_test, third_y1, third_y1_test, third_y2, third_y2_test = split_data(dataset, third_x, third_x_test, third_y1, third_y1_test, third_y2, third_y2_test, 280, np.shape(dataset)[0])

# Set the Xs in 2D 
first_x = first_x[:, np.newaxis]
first_x_test = first_x_test[:, np.newaxis]
second_x = second_x[:, np.newaxis]
second_x_test = second_x_test[:, np.newaxis]
third_x = third_x[:, np.newaxis]
third_x_test = third_x_test[:, np.newaxis]


## Display datacloud with plt.scatter
plt.figure(figsize=(10, 10))
plt.title("COVID-19 Daily new cases evolution in France April 2020 to December 2020")
plt.scatter(first_x, first_y1)
plt.show()
plt.figure(figsize=(10, 10))
plt.title("COVID-19 Daily new deaths evolution in France April 2020 to December 2020")
plt.scatter(first_x, first_y2)
plt.show()

plt.figure(figsize=(10, 10))
plt.title("COVID-19 Daily new cases evolution in France January 2021 to November 2021")
plt.scatter(second_x, second_y1)
plt.show()
plt.figure(figsize=(10, 10))
plt.title("COVID-19 Daily new deaths evolution in France January 2021 to November 2021")
plt.scatter(second_x, second_y2)
plt.show()

plt.figure(figsize=(10, 10))
plt.title("COVID-19 Daily new cases evolution in France December 2021 to April 2022")
plt.scatter(third_x, third_y1)
plt.show()
plt.figure(figsize=(10, 10))
plt.title("COVID-19 Daily new deaths evolution in France December 2021 to April 2022")
plt.scatter(third_x, third_y2)
plt.show()